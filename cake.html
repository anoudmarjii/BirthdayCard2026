<!DOCTYPE html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday ðŸŽ‚</title>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<link rel="stylesheet" href="styles.css">
</head>

<body>

  <h1>Happy Birthday Dad &nbsp;<i class='bx bxs-heart' id="heart"></i></h1>
  <h2>Make a Wish</h2>

  <dic class="celebration"></dic>

  <div class="balloon"></div>
  <div class="balloon-left"></div>

  <div class="cake">
    <div class="candle">
      <div class="flame"></div>
    </div>
    <div class="candle">
      <div class="flame"></div>
    </div>
    <div class="candle">
      <div class="flame"></div>
    </div>
  </div>

  <div class="cake2"></div>
  <div class="cake3"></div>
  </div>

  <button id="startBtn" style="display: none;">Click to Blow the Candles</button>

  <!-- Background music -->
  <audio id="bg_music" src="birthday_song.mp3" autoplay></audio>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    const music = document.getElementById('bg_music');
    const blowButton = document.getElementById('startBtn');

    music.addEventListener('loadedmetadata', () => {
      music.currentTime = 4;
      music.play();
    });

    // Show blow button after 5 seconds (optional timing)
    setTimeout(() => {
      blowButton.style.display = 'inline-block';
    }, 5000);

    // When user clicks blow candles
    blowButton.addEventListener('click', () => {
      music.pause();
    });

    const startBtn = document.getElementById("startBtn");

    startBtn.addEventListener("click", async () => {
      startBtn.innerText = "Listening... Blow! ðŸ’¨";

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const microphone = audioContext.createMediaStreamSource(stream);
        const analyser = audioContext.createAnalyser();

        microphone.connect(analyser);
        analyser.fftSize = 256;

        const dataArray = new Uint8Array(analyser.frequencyBinCount);

        function detectSound() {
          analyser.getByteFrequencyData(dataArray);

          let volume = 0;
          for (let i = 0; i < dataArray.length; i++) {
            volume += dataArray[i];
          }
          volume = volume / dataArray.length;

          if (volume > 40) { // sensitivity level
            blowOut();
            return;
          }

          requestAnimationFrame(detectSound);
        }

        detectSound();

      } catch (error) {
        alert("Microphone access denied ðŸ˜¢");
      }
    });

    function blowOut() {
      document.querySelectorAll(".flame").forEach(flame => {
        flame.style.display = "none";
      });

      confetti();

      startBtn.innerText = "ðŸŽ‰ Happy Birthday!";
    }
  </script>

  <footer>
    <h4 id="footerRights"><i class='bx bx-copyright' id="copyrightSymbol"></i>2026 GraphiXy. All Rights Reserved.</h4>
  </footer>
</body>


</html>

